<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Department of Bitcoin | Live Dashboard</title>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<style>
:root {
  --bg:#f4f6f9; --text:#111; --primary:#0b1f3a; --accent:#c8a200;
}
body.dark{--bg:#0e243f;--text:#fff;}
body{margin:0;font-family:system-ui,sans-serif;background:var(--bg);color:var(--text);}
header{background:var(--primary);color:white;text-align:center;padding:20px;}
header img{width:80px;}
nav{display:flex;justify-content:center;gap:20px;padding:10px;}
.dashboard{display:grid;grid-template-columns:repeat(auto-fit,minmax(200px,1fr));gap:20px;padding:30px;}
.card{border-left:5px solid var(--accent);padding:15px;background:white;}
body.dark .card{background:#1b355e;}
footer{background:var(--primary);color:white;text-align:center;padding:15px;}
.disclaimer{font-size:12px;opacity:0.7;}
table{width:100%;border-collapse:collapse;margin-top:20px;}
th,td{border:1px solid #ccc;padding:8px;text-align:center;}
th{background:var(--primary);color:white;}
body.dark th{background:#142c4f;}
</style>
</head>
<body>

<header>
  <img src="seal.svg" alt="Official Seal">
  <h1>Department of Bitcoin</h1>
  <p>Live Digital Asset Dashboard</p>
  <button id="themeToggle">Toggle Dark/Light</button>
</header>

<nav>
  <select id="assetSelect">
    <option value="bitcoin">Bitcoin</option>
    <option value="ethereum">Ethereum</option>
    <option value="tether">Tether</option>
    <option value="solana">Solana</option>
  </select>
  <select id="timeframe">
    <option value="1">1D</option>
    <option value="7">7D</option>
    <option value="30" selected>1M</option>
    <option value="90">3M</option>
    <option value="365">1Y</option>
    <option value="max">ALL</option>
  </select>
</nav>

<section class="dashboard">
  <div class="card"><h3>Price</h3><p id="price">Loading...</p></div>
  <div class="card"><h3>Market Cap</h3><p id="marketcap">Loading...</p></div>
  <div class="card"><h3>24h Change</h3><p id="change">Loading...</p></div>
  <div class="card"><h3>BTC Dominance</h3><p id="dominance">Loading...</p></div>
  <div class="card"><h3>Live BTC Price</h3><p id="liveTicker">Loading...</p></div>
</section>

<section>
  <canvas id="chart" style="max-width:100%;height:400px;"></canvas>
</section>

<section>
  <h2>ETF Inflow Tracker</h2>
  <table id="etfTable">
    <thead><tr><th>ETF</th><th>BTC</th><th>USD</th></tr></thead>
    <tbody></tbody>
  </table>
</section>

<section>
  <h2>Corporate Treasury Tracker</h2>
  <table id="treasuryTable">
    <thead><tr><th>Company</th><th>BTC</th><th>USD</th></tr></thead>
    <tbody></tbody>
  </table>
</section>

<footer>
  © 2026 Department of Bitcoin — Public Information Service
  <p class="disclaimer">Not affiliated with any government authority.</p>
</footer>

<script>
const API = "https://https://departmentof-bitcoin-xlxe.vercel.app/api"; // <-- replace with your Vercel backend URL
let chart;

async function loadData() {
  const asset = document.getElementById("assetSelect").value;
  const days = document.getElementById("timeframe").value;

  // Market
  const market = await fetch(`${API}?endpoint=market&coin=${asset}`).then(r=>r.json());
  const chartData = await fetch(`${API}?endpoint=chart&coin=${asset}&days=${days}`).then(r=>r.json());
  const global = await fetch(`${API}?endpoint=global`).then(r=>r.json());

  document.getElementById("price").innerText = "$" + market.market_data.current_price.usd.toLocaleString();
  document.getElementById("marketcap").innerText = "$" + market.market_data.market_cap.usd.toLocaleString();
  document.getElementById("change").innerText = market.market_data.price_change_percentage_24h.toFixed(2) + "%";
  document.getElementById("dominance").innerText = global.data.market_cap_percentage.btc.toFixed(2) + "%";

  // Chart
  const prices = chartData.prices.map(p=>p[1]);
  const labels = chartData.prices.map(p=>new Date(p[0]).toLocaleDateString());
  if(chart) chart.destroy();
  chart = new Chart(document.getElementById("chart"),{
    type:"line",
    data:{labels,datasets:[{label:asset.toUpperCase()+" Price (USD)",data:prices,borderColor:"#c8a200",backgroundColor:"rgba(200,162,0,0.1)",fill:true}]}
  });

  // ETF
  const etfData = await fetch(`${API}?endpoint=etf`).then(r=>r.json());
  const etfBody = document.querySelector("#etfTable tbody");
  etfBody.innerHTML = "";
  etfData.etfs.forEach(e=> {
    etfBody.innerHTML += `<tr><td>${e.name}</td><td>${e.btc.toLocaleString()}</td><td>$${e.usd.toLocaleString()}</td></tr>`;
  });

  // Treasury
  const treasuryData = await fetch(`${API}?endpoint=treasury`).then(r=>r.json());
  const treasuryBody = document.querySelector("#treasuryTable tbody");
  treasuryBody.innerHTML = "";
  treasuryData.companies.forEach(c=> {
    treasuryBody.innerHTML += `<tr><td>${c.name}</td><td>${c.btc.toLocaleString()}</td><td>$${c.usd.toLocaleString()}</td></tr>`;
  });
}

// WebSocket BTC Price
const socket = new WebSocket("wss://stream.binance.com:9443/ws/btcusdt@trade");
socket.onmessage = event => {
  const data = JSON.parse(event.data);
  document.getElementById("liveTicker").innerText = "$" + parseFloat(data.p).toLocaleString();
};

// Event listeners
document.getElementById("assetSelect").onchange = loadData;
document.getElementById("timeframe").onchange = loadData;
document.getElementById("themeToggle").onclick = ()=>{ document.body.classList.toggle("dark"); };

loadData();
setInterval(loadData,60000);
</script>
</body>
</html>
